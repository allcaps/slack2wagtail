{% extends "base.html" %}
{% load static wagtailcore_tags %}

{% block extra_css %}
{% endblock extra_css %}

{% block content %}

  <h1>{{ self.title }}</h1>
  <p>Created {{ self.first_published_at }}</p>

  <div id="updates-container">
    {% for block in self.body reversed %}
      {% include_block block %}
    {% endfor %}
  </div>

  <script>
      const socket = new WebSocket(`ws://${window.location.host}/ws/update/{{ page.group_name }}/`);
      const messageContainer = document.getElementById('updates-container');

      socket.onmessage = (e) => {
          let data = JSON.parse(e.data);
          let { message, renders } = data;
          messageContainer.innerHTML = Array.from(renders).join('') + messageContainer.innerHTML;
          console.log(message);
      };

      socket.onclose = (e) => {
          console.error('Chat socket closed unexpectedly');
      };

      // document.querySelector('#chat-message-input').focus();
      // document.querySelector('#chat-message-input').onkeyup = function(e) {
      //     if (e.keyCode === 13) {  // enter, return
      //         document.querySelector('#chat-message-submit').click();
      //     }
      // };
      //
      // document.querySelector('#chat-message-submit').onclick = function(e) {
      //     var messageInputDom = document.querySelector('#chat-message-input');
      //     var message = messageInputDom.value;
      //     chatSocket.send(JSON.stringify({
      //         'message': message
      //     }));
      //
      //     messageInputDom.value = '';
      // };
  </script>

{% endblock content %}
